<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibi Showdown</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&family=Space+Mono:wght@400;700&display=swap");

      :root {
        --bg-1: #0f1014;
        --bg-2: #1b1f2a;
        --panel: #1f2431;
        --panel-2: #151a24;
        --accent: #ffcf6a;
        --accent-2: #6ed6ff;
        --text: #f5f7ff;
        --muted: #9aa5b1;
        --danger: #ff6b6b;
        --ok: #5ef2a0;
        --shadow: rgba(0, 0, 0, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Sora", system-ui, sans-serif;
        color: var(--text);
        background: radial-gradient(circle at top, #2a2f3d 0%, #12131a 45%, #0c0d12 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      #app {
        width: 100%;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
        position: relative;
      }

      #stage {
        --side-chat-width: min(210px, 34vw);
        --game-size: min(calc(100vw - 32px - var(--side-chat-width) - 12px), calc(100vh - 32px));
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      #game {
        width: min(var(--game-size), 780px);
        height: min(var(--game-size), 780px);
        max-width: 780px;
        max-height: 780px;
        background: linear-gradient(160deg, #1a1f2b 0%, #0f121b 70%);
        border-radius: 22px;
        box-shadow: 0 30px 70px var(--shadow);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      #frame {
        height: 100%;
        display: grid;
        grid-template-rows: 1fr 1.4fr 1fr;
        gap: 8px;
        padding: 14px;
      }

      body.prematch-open #frame {
        visibility: hidden;
      }


      .panel {
        background: rgba(31, 36, 49, 0.9);
        border-radius: 18px;
        padding: 12px;
        display: grid;
        gap: 10px;
        align-items: center;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        --sprite-col: 120px;
      }

      .panel.enemy {
        grid-template-columns: 1fr 120px;
      }

      .panel.player {
        grid-template-columns: 120px 1fr;
      }

      .panel.enemy .panel-info {
        text-align: right;
        align-items: stretch;
      }

      .bench {
        display: flex;
        gap: 6px;
        margin-top: 6px;
        justify-content: flex-start;
      }

      .panel.enemy .bench {
        justify-content: flex-end;
      }

      .bench-slot {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(10, 12, 18, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4px;
        cursor: pointer;
      }

      .bench-slot img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .bench-slot.empty {
        opacity: 0.35;
        cursor: default;
      }

      .bench-slot:disabled {
        cursor: default;
        opacity: 0.5;
      }

      .panel-info {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .panel-name {
        font-size: 16px;
        font-weight: 700;
      }

      .panel-sub {
        font-size: 13px;
        color: var(--muted);
      }

      .hp-bar {
        height: 10px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        overflow: hidden;
      }

      .hp-bar span {
        display: block;
        height: 100%;
        width: 100%;
        background: linear-gradient(90deg, #5ef2a0 0%, #ffcf6a 65%, #ff7d7d 100%);
        transition: width 0.25s ease;
        will-change: width;
      }

      .hp-bar span.hp-anim {
        transition-delay: 0.18s;
      }

      .effects-row {
        min-height: 18px;
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
      }

      .panel.enemy .effects-row {
        justify-content: flex-end;
      }

      .effect-chip {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 7px;
        border-radius: 999px;
        font-size: 10px;
        font-family: "Space Mono", monospace;
        letter-spacing: 0.03em;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(255, 255, 255, 0.08);
        color: #e9f9ff;
      }

      .effect-chip.seeded {
        background: rgba(44, 84, 51, 0.75);
        border-color: rgba(143, 242, 166, 0.55);
      }

      .effect-chip.drain {
        background: rgba(27, 70, 83, 0.75);
        border-color: rgba(111, 214, 255, 0.55);
      }

      .effect-chip.buff {
        background: rgba(44, 84, 51, 0.75);
        border-color: rgba(143, 242, 166, 0.55);
      }

      .effect-chip.debuff {
        background: rgba(104, 48, 48, 0.75);
        border-color: rgba(255, 141, 141, 0.55);
      }

      .effect-chip.passive {
        background: rgba(35, 52, 86, 0.75);
        border-color: rgba(159, 194, 255, 0.55);
      }

      .effect-dot {
        width: 6px;
        height: 6px;
        border-radius: 1px;
        background: #9df27b;
      }

      .effect-chip.debuff .effect-dot {
        background: #ff9b9b;
      }

      .effect-chip.passive .effect-dot {
        background: #a6c4ff;
      }

      .sprite {
        width: 100%;
        height: 100%;
        border-radius: 16px;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      .sprite::after {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(255, 70, 70, 0.8);
        opacity: 0;
        pointer-events: none;
        mix-blend-mode: screen;
        z-index: 4;
      }

      .sprite.hit::after {
        animation: hitFlash 0.4s ease;
      }

      .sprite::before {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(80, 255, 140, 0.75);
        opacity: 0;
        pointer-events: none;
        mix-blend-mode: screen;
        z-index: 3;
      }

      .sprite.heal::before {
        animation: healFlash 0.35s ease;
      }

      .sprite.jump {
        animation: jump 0.3s ease;
      }

      .sprite img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        filter: drop-shadow(0 12px 22px rgba(0, 0, 0, 0.45));
        position: relative;
        z-index: 1;
      }

      .seed-sprout {
        position: absolute;
        right: 8px;
        bottom: 8px;
        width: 16px;
        height: 16px;
        opacity: 0;
        transform: translateY(2px) scale(0.92);
        transition: opacity 0.15s ease, transform 0.15s ease;
        pointer-events: none;
        z-index: 5;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.45));
      }

      .seed-sprout::before {
        content: "";
        position: absolute;
        width: 3px;
        height: 3px;
        left: 7px;
        top: 9px;
        background: #7f5838;
        box-shadow: 0 3px #7f5838;
      }

      .seed-sprout::after {
        content: "";
        position: absolute;
        width: 3px;
        height: 3px;
        left: 5px;
        top: 4px;
        background: #72d45d;
        box-shadow:
          3px -2px #9bf47c,
          3px 1px #4ea84d,
          6px -1px #66c65d;
      }

      .sprite.seeded .seed-sprout {
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      .shield {
        position: absolute;
        width: 42%;
        aspect-ratio: 1;
        border-radius: 50%;
        background: rgba(200, 200, 200, 0.6);
        opacity: 0;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.7);
        box-shadow: 0 0 10px rgba(200, 200, 200, 0.35);
        z-index: 2;
        pointer-events: none;
      }

      .sprite.shield-on .shield {
        animation: shieldAppear 0.4s ease;
      }

      .sprite.shield-hit .shield {
        animation: shieldHit 0.45s ease;
      }

      .arena {
        background: linear-gradient(160deg, #121827 0%, #0e111a 70%);
        border-radius: 18px;
        padding: 12px;
        display: grid;
        grid-template-rows: auto 1fr;
        gap: 10px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        position: relative;
      }

      .arena-top {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        font-size: 12px;
        color: var(--muted);
      }

      .status-line {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        font-family: "Space Mono", monospace;
        color: var(--accent);
      }

      .action-pad {
        background: rgba(12, 14, 20, 0.6);
        border-radius: 16px;
        padding: 16px;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
        align-content: center;
        justify-content: center;
        font-family: "Space Mono", monospace;
        font-size: 18px;
      }

      .action-pad .action-btn {
        border: none;
        border-radius: 12px;
        padding: 14px 12px;
        background: rgba(255, 255, 255, 0.08);
        color: var(--text);
        font-weight: 600;
        cursor: pointer;
        min-height: 52px;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }

      .action-pad .action-btn:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.35);
      }

      .action-pad .action-btn.selected-intent {
        box-shadow: inset 0 0 0 2px rgba(110, 214, 255, 0.75);
      }

      .action-pad .action-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .action-pad .switch-btn {
        grid-column: span 2;
        background: linear-gradient(140deg, #6ed6ff, #5ef2a0);
        color: #0b1220;
        font-weight: 700;
      }

      .action-pad .action-btn.danger {
        grid-column: span 2;
        background: linear-gradient(140deg, #ff5d5d, #ff8a5c);
        color: #1b0b0b;
        font-weight: 700;
      }

      .bench-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .panel.enemy .bench-row {
        justify-content: space-between;
        flex-direction: row-reverse;
      }

      .panel.player .bench-row {
        justify-content: space-between;
      }

      .surrender-btn {
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        padding: 7px 14px;
        min-width: 96px;
        background: rgba(255, 255, 255, 0.09);
        color: #f6e6e6;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
      }

      .surrender-btn.hidden {
        display: none;
      }

      .chat {
        background: rgba(8, 10, 14, 0.8);
        border-radius: 12px;
        padding: 8px;
        display: grid;
        grid-template-rows: auto 1fr auto;
        gap: 6px;
        font-family: "Space Mono", monospace;
        font-size: 12px;
        color: #d0d6ff;
        border: 1px solid rgba(255, 255, 255, 0.04);
      }

      .chat h6 {
        margin: 0;
        font-size: 10px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .chat-messages {
        overflow-y: auto;
        overflow-x: hidden;
        display: grid;
        gap: 3px;
        align-content: start;
        padding-right: 1px;
        scrollbar-gutter: stable;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.12) transparent;
        color-scheme: dark;
      }

      .chat-messages::-webkit-scrollbar {
        width: 7px;
        background: transparent;
      }

      .chat-messages::-webkit-scrollbar-track {
        background: transparent;
        border-radius: 999px;
      }

      .chat-messages::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 999px;
        border: 2px solid transparent;
        background-clip: content-box;
      }

      .chat-messages::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.16);
      }

      .chat-messages p {
        margin: 0;
      }

      .chat-messages p.log-user {
        color: #ffd76e;
        background: rgba(255, 215, 110, 0.12);
        border: 1px solid rgba(255, 215, 110, 0.28);
        border-radius: 8px;
        padding: 4px 6px;
      }

      .chat-messages p.log-turn {
        color: #89e9ff;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        border-top: 1px solid rgba(137, 233, 255, 0.35);
        margin-top: 4px;
        padding-top: 6px;
      }

      .chat-messages p.log-match {
        color: #f4ff7a;
        font-weight: 800;
        letter-spacing: 0.14em;
        text-transform: uppercase;
        border-top: 1px solid rgba(244, 255, 122, 0.55);
        margin-top: 8px;
        padding-top: 8px;
        text-shadow: 0 0 6px rgba(244, 255, 122, 0.45);
      }

      .chat-input {
        display: flex;
        gap: 6px;
      }

      .chat-input input {
        flex: 1;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(10, 12, 18, 0.8);
        color: var(--text);
        padding: 5px 8px;
        font-family: "Space Mono", monospace;
        font-size: 11px;
      }

      .chat-input button {
        border: none;
        border-radius: 8px;
        padding: 6px 8px;
        background: rgba(255, 255, 255, 0.08);
        color: var(--text);
        cursor: pointer;
        font-size: 11px;
      }

      .stat-tooltip {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 80;
        min-width: 220px;
        max-width: 280px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(7, 10, 15, 0.95);
        box-shadow: 0 16px 30px rgba(0, 0, 0, 0.45);
        padding: 10px;
        pointer-events: none;
        opacity: 0;
        transform: translateY(4px);
        transition: opacity 0.12s ease, transform 0.12s ease;
      }

      .stat-tooltip.is-open {
        opacity: 1;
        transform: translateY(0);
      }

      .stat-tooltip-title {
        font-family: "Sora", system-ui, sans-serif;
        font-size: 13px;
        font-weight: 700;
        color: #f5f7ff;
        margin-bottom: 6px;
      }

      .stat-tooltip-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 4px 8px;
        font-family: "Space Mono", monospace;
        font-size: 11px;
      }

      .stat-tooltip-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        border-radius: 7px;
        padding: 3px 5px;
        background: rgba(255, 255, 255, 0.04);
      }

      .stat-tooltip-label {
        color: #9aa5b1;
      }

      .stat-tooltip-value {
        font-weight: 700;
      }

      .stat-tooltip-value.up {
        color: #6ff7b0;
      }

      .stat-tooltip-value.down {
        color: #ff8e8e;
      }

      .stat-tooltip-value.neutral {
        color: #fff;
      }

      .stat-tooltip-hp {
        margin-top: 6px;
        font-family: "Space Mono", monospace;
        font-size: 11px;
        color: #9aa5b1;
      }

      .stat-tooltip-passive {
        margin-top: 6px;
        font-family: "Space Mono", monospace;
        font-size: 11px;
        color: #ffd76e;
      }

      .stat-tooltip-moves {
        margin-top: 6px;
        display: grid;
        gap: 2px;
        font-family: "Space Mono", monospace;
        font-size: 10px;
        color: #c6d0ec;
      }

      .side-panel {
        width: var(--side-chat-width);
        height: min(var(--game-size), 780px);
        display: grid;
        grid-template-rows: auto 2fr 3fr;
        gap: 6px;
      }

      .side-panel > * {
        min-height: 0;
      }

      .side-info {
        background: rgba(8, 10, 14, 0.8);
        border-radius: 12px;
        padding: 8px;
        display: grid;
        gap: 4px;
        font-family: "Space Mono", monospace;
        font-size: 11px;
        color: #d0d6ff;
        border: 1px solid rgba(255, 255, 255, 0.04);
      }

      .participants {
        background: rgba(8, 10, 14, 0.8);
        border-radius: 12px;
        padding: 8px;
        display: grid;
        grid-template-rows: auto 1fr;
        gap: 6px;
        font-family: "Space Mono", monospace;
        font-size: 11px;
        color: #d0d6ff;
        border: 1px solid rgba(255, 255, 255, 0.04);
      }

      .participants h6 {
        margin: 0;
        font-size: 10px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .participants-list {
        overflow: auto;
        display: grid;
        gap: 3px;
        align-content: start;
      }

      .participant {
        display: flex;
        justify-content: space-between;
        gap: 6px;
        align-items: center;
      }

      .participant-meta {
        color: var(--muted);
        font-size: 10px;
      }

      .switch-modal {
        position: absolute;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(8, 10, 14, 0.7);
        backdrop-filter: blur(4px);
        z-index: 3;
      }

      .switch-modal.open {
        display: flex;
      }

      .switch-panel {
        background: rgba(18, 22, 32, 0.95);
        border-radius: 14px;
        padding: 12px;
        width: min(240px, 80%);
        display: grid;
        gap: 10px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      .switch-title {
        font-size: 12px;
        font-weight: 700;
        color: var(--accent);
      }

      .switch-options {
        display: grid;
        gap: 6px;
      }

      .switch-options button {
        border: none;
        border-radius: 10px;
        padding: 8px 10px;
        background: rgba(255, 255, 255, 0.08);
        color: var(--text);
        font-size: 12px;
        cursor: pointer;
      }

      .switch-options button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .switch-close {
        border: none;
        border-radius: 10px;
        padding: 8px 10px;
        background: rgba(255, 255, 255, 0.08);
        color: var(--text);
        font-size: 11px;
        cursor: pointer;
      }

      .actions {
        display: grid;
        gap: 10px;
      }

      .action-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }

      .action-grid label {
        font-size: 11px;
        color: var(--muted);
        display: grid;
        gap: 6px;
      }

      .action-grid select {
        width: 100%;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(10, 12, 18, 0.8);
        color: var(--text);
        padding: 6px 8px;
      }

      .actions button {
        border: none;
        border-radius: 12px;
        padding: 8px;
        background: #222a3a;
        color: var(--text);
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }

      .actions button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.35);
      }

      .actions button.primary {
        background: linear-gradient(140deg, #ffcf6a, #ff8f6a);
        color: #241a10;
      }

      #prematch {
        position: absolute;
        inset: 0;
        background: rgba(10, 12, 18, 0.88);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px;
        animation: fadeIn 0.4s ease;
      }

      #match-end {
        position: absolute;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(6, 10, 18, 0.85);
        z-index: 40;
      }

      #match-end.open {
        display: flex;
      }

      .match-end-card {
        background: rgba(15, 20, 35, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 18px;
        padding: 24px;
        width: min(420px, 90vw);
        text-align: center;
        color: var(--text);
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.4);
      }

      .match-end-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .match-end-sub {
        opacity: 0.8;
        margin-bottom: 18px;
      }

      .match-end-card button {
        border: none;
        border-radius: 12px;
        padding: 10px 16px;
        background: linear-gradient(140deg, #6ed6ff, #5ef2a0);
        color: #0b1220;
        font-weight: 700;
        cursor: pointer;
      }

      .setup-card {
        width: 100%;
        height: 100%;
        background: rgba(23, 27, 37, 0.95);
        border-radius: 18px;
        padding: 14px;
        display: grid;
        grid-template-rows: auto 1fr auto;
        gap: 10px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        min-height: 0;
      }

      .setup-title {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 700;
        font-size: 18px;
      }

      .setup-title-actions {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .setup-grid {
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 10px;
        height: 100%;
        min-height: 0;
        overflow-y: auto;
        padding-right: 4px;
      }

      .roster {
        background: rgba(15, 18, 26, 0.8);
        border-radius: 14px;
        padding: 10px;
        display: grid;
        grid-template-rows: auto 1fr;
        gap: 10px;
        min-height: 0;
      }

      .roster-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      .roster-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 4px;
        overflow-y: auto;
        overflow-x: hidden;
        min-height: 0;
        padding-right: 2px;
      }

      .roster-card {
        background: rgba(255, 255, 255, 0.04);
        border-radius: 10px;
        padding: 3px 5px;
        display: grid;
        grid-template-columns: 24px 1fr;
        gap: 4px;
        align-items: center;
        border: 1px solid transparent;
      }

      .roster-card.active {
        border-color: rgba(255, 207, 106, 0.6);
        box-shadow: inset 0 0 0 1px rgba(255, 207, 106, 0.4);
      }

      .roster-card.disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .roster-card h4 {
        margin: 0;
        font-size: 13px;
        line-height: 1.1;
      }

      .roster-card p {
        margin: 0;
        font-size: 11px;
        line-height: 1.1;
        color: var(--muted);
      }

      .chip {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 10px;
        background: rgba(255, 255, 255, 0.08);
        color: var(--muted);
      }

      .build {
        display: grid;
        gap: 8px;
        grid-template-rows: auto 1fr;
        min-height: 0;
      }

      .slot-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 8px;
      }

      .slot-card {
        border: none;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 14px;
        padding: 6px;
        padding-bottom: 30px;
        aspect-ratio: 1 / 1;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 1px solid transparent;
        transition: border-color 0.2s ease, transform 0.2s ease;
        position: relative;
      }

      .slot-card.active {
        border-color: rgba(255, 207, 106, 0.6);
        box-shadow: inset 0 0 0 1px rgba(255, 207, 106, 0.35);
      }

      .slot-card.empty {
        opacity: 0.6;
      }

      .slot-image {
        width: min(56px, 70%);
        height: min(56px, 70%);
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translateY(-4px);
      }

      .slot-card img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .slot-card img.hidden {
        display: none;
      }

      .slot-name {
        font-size: 12px;
        font-weight: 600;
        line-height: 1.1;
        text-align: center;
        max-width: calc(100% - 12px);
        min-height: 2.2em;
        max-height: 2.2em;
        color: var(--text);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.45);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        position: absolute;
        left: 6px;
        right: 6px;
        bottom: 6px;
      }

      .slot-card:focus-visible {
        outline: 2px solid rgba(255, 207, 106, 0.5);
        outline-offset: 2px;
      }

      .slot-badge {
        position: absolute;
        top: 6px;
        left: 6px;
        font-size: 13px;
        color: var(--accent);
        opacity: 0;
        pointer-events: none;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.6);
      }

      .slot-card.show-badge .slot-badge {
        opacity: 0.9;
      }

      .slot-card.empty .slot-image {
        display: none;
      }

      .config {
        background: rgba(15, 18, 26, 0.8);
        border-radius: 14px;
        padding: 10px;
        display: grid;
        gap: 10px;
        min-height: 0;
        --moves-h: 170px;
        --stats-h: 190px;
        grid-template-rows: auto var(--moves-h) var(--stats-h) auto;
      }

      .tabs {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
      }

      .tab {
        border: none;
        border-radius: 999px;
        padding: 6px 12px;
        background: rgba(255, 255, 255, 0.06);
        color: var(--muted);
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .tab img {
        width: 14px;
        height: 14px;
        border-radius: 4px;
        object-fit: cover;
      }

      .tab.active {
        background: linear-gradient(140deg, rgba(110, 214, 255, 0.9), rgba(94, 242, 160, 0.9));
        color: #0c1220;
      }

      .config-group {
        display: grid;
        gap: 8px;
        min-height: 0;
        grid-template-rows: auto minmax(0, 1fr);
      }

      .config-group h6 {
        margin: 0;
        font-size: 11px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .config h5 {
        margin: 0;
        font-size: 12px;
        color: var(--muted);
      }

      .config-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
        min-height: 0;
        align-content: start;
      }

      .config-grid label {
        font-size: 11px;
        color: var(--muted);
      }

      .config-grid input:not([type="range"]),
      .config-grid select {
        width: 100%;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(10, 12, 18, 0.8);
        color: var(--text);
        padding: 5px 8px;
      }

      #stats-grid {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .stat-points-summary {
        font-size: 11px;
        color: var(--accent);
        font-family: "Space Mono", monospace;
      }

      .stat-alloc-header {
        display: grid;
        grid-template-columns: 36px calc(76px * 16 / 25) calc(76px * 16 / 25) minmax(90px, 1fr) 56px;
        align-items: center;
        gap: 6px;
      }

      .stat-alloc-header-cell {
        font-size: 10px;
        color: var(--muted);
        font-family: "Space Mono", monospace;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }

      .stat-alloc-header-cell.is-empty {
        opacity: 0;
      }

      .stat-alloc-row {
        display: grid;
        grid-template-columns: 36px calc(76px * 16 / 25) calc(76px * 16 / 25) minmax(90px, 1fr) 56px;
        align-items: center;
        gap: 6px;
      }

      .stat-alloc-name {
        font-size: 11px;
        color: var(--muted);
        font-family: "Space Mono", monospace;
        text-transform: uppercase;
      }

      .stat-alloc-input {
        width: 100%;
      }

      .stat-alloc-input {
        text-align: center;
        padding: 5px 6px !important;
        font-size: 11px;
      }

      .stat-static-value,
      .stat-result-value {
        display: block;
        width: 100%;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(10, 12, 18, 0.5);
        color: var(--text);
        font-size: 11px;
        font-family: "Space Mono", monospace;
        text-align: center;
        padding: 5px 6px;
        line-height: 1.2;
      }

      .stat-static-value {
        opacity: 0.82;
      }

      .stat-result-value {
        opacity: 0.74;
      }

      .stat-alloc-slider {
        width: 100%;
        margin: 0;
        padding: 0;
        border: none;
        background: transparent;
        accent-color: #6ed6ff;
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 10px;
        font-weight: 600;
      }

      .status-pill.ok {
        background: rgba(94, 242, 160, 0.2);
        color: var(--ok);
      }

      .status-pill.warn {
        background: rgba(255, 207, 106, 0.2);
        color: var(--accent);
      }

      .status-pill.off {
        background: rgba(255, 255, 255, 0.08);
        color: var(--muted);
      }

      .warning {
        font-size: 11px;
        color: var(--danger);
        min-height: 14px;
      }

      .setup-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      #ready-btn {
        border: none;
        border-radius: 12px;
        padding: 8px 14px;
        background: linear-gradient(140deg, #6ed6ff, #5ef2a0);
        color: #0b1220;
        font-weight: 700;
        cursor: pointer;
      }

      #reset-status-btn {
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 12px;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        font-weight: 600;
        cursor: pointer;
      }

      #reset-status-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .hint {
        font-size: 11px;
        color: var(--muted);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes jump {
        0% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-8px);
        }
        70% {
          transform: translateY(0);
        }
        100% {
          transform: translateY(0);
        }
      }

      @keyframes hitFlash {
        0% {
          opacity: 0;
        }
        20% {
          opacity: 0.8;
        }
        40% {
          opacity: 0;
        }
        60% {
          opacity: 0.8;
        }
        100% {
          opacity: 0;
        }
      }

      @keyframes healFlash {
        0% {
          opacity: 0;
        }
        35% {
          opacity: 0.75;
        }
        100% {
          opacity: 0;
        }
      }

      @keyframes shieldAppear {
        0% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.6);
        }
        60% {
          opacity: 0.6;
          transform: translate(-50%, -50%) scale(1);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      @keyframes shieldHit {
        0% {
          opacity: 0.6;
          background: rgba(200, 200, 200, 0.6);
        }
        35% {
          opacity: 0.9;
          background: rgba(255, 70, 70, 0.8);
        }
        100% {
          opacity: 0;
          background: rgba(255, 70, 70, 0);
        }
      }

      @media (max-width: 680px) {
        #frame {
          padding: 14px;
        }

        #stage {
          flex-direction: column;
        }

        #stage {
          --game-size: min(calc(100vw - 32px), calc(100vh - 32px - 180px));
        }

        .side-panel {
          width: min(320px, calc(100vw - 32px));
          height: 220px;
        }

        .setup-grid {
          grid-template-columns: 1fr;
        }

        .config {
          --moves-h: 190px;
          --stats-h: 220px;
        }

        .stat-alloc-row {
          grid-template-columns: 34px calc(60px * 4 / 5) calc(60px * 4 / 5) minmax(80px, 1fr);
          gap: 4px;
        }

        .action-grid {
          grid-template-columns: 1fr;
        }

        .actions {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="stage">
        <div id="game">
          <div id="frame">
            <section class="panel enemy">
              <div class="panel-info">
                <div class="panel-name" id="enemy-name">Enemy</div>
                <div class="panel-sub" id="enemy-meta">Lv 10 · HP 40/40</div>
                <div class="hp-bar"><span id="enemy-hp"></span></div>
                <div class="effects-row" id="enemy-effects"></div>
                <div class="bench-row">
                  <div class="bench" id="enemy-bench">
                    <button class="bench-slot empty" id="enemy-bench-0" type="button" disabled>
                      <img id="enemy-bench-0-img" alt="" />
                    </button>
                    <button class="bench-slot empty" id="enemy-bench-1" type="button" disabled>
                      <img id="enemy-bench-1-img" alt="" />
                    </button>
                  </div>
                </div>
              </div>
            <div class="sprite" id="enemy-sprite-wrap">
              <div class="shield"></div>
              <div class="seed-sprout" aria-hidden="true"></div>
              <img id="enemy-sprite" src="./icons/unit_harpy.png" alt="Enemy" />
            </div>
            </section>

            <section class="arena">
              <div class="arena-top">
                <div class="status-line">
                  <span>Turn <span id="status-turn">0</span></span>
                  <span id="status-deadline">--:--</span>
                </div>
              </div>
              <div class="action-pad" id="action-pad">
                <button class="action-btn" id="move-btn-0">Move 1</button>
                <button class="action-btn" id="move-btn-1">Move 2</button>
                <button class="action-btn" id="move-btn-2">Move 3</button>
                <button class="action-btn" id="move-btn-3">Move 4</button>
              </div>
              <div class="switch-modal" id="switch-modal">
                <div class="switch-panel">
                  <div class="switch-title">Switch Pokemon</div>
                  <div class="switch-options" id="switch-options"></div>
                  <button class="switch-close" id="switch-close">Cancel</button>
                </div>
              </div>
            </section>

            <section class="panel player">
            <div class="sprite" id="player-sprite-wrap">
              <div class="shield"></div>
              <div class="seed-sprout" aria-hidden="true"></div>
              <img id="player-sprite" src="./icons/unit_knight.png" alt="Player" />
            </div>
              <div class="panel-info">
                <div class="panel-name" id="player-name">Player</div>
                <div class="panel-sub" id="player-meta">Lv 10 · HP 40/40</div>
                <div class="hp-bar"><span id="player-hp"></span></div>
                <div class="effects-row" id="player-effects"></div>
                <div class="bench-row">
                  <div class="bench" id="player-bench">
                    <button class="bench-slot empty" id="player-bench-0" type="button">
                      <img id="player-bench-0-img" alt="" />
                    </button>
                    <button class="bench-slot empty" id="player-bench-1" type="button">
                      <img id="player-bench-1-img" alt="" />
                    </button>
                  </div>
                  <button class="surrender-btn hidden" id="surrender-btn" type="button">Surrender</button>
                </div>
              </div>
            </section>
          </div>

          <div id="prematch">
            <div class="setup-card">
              <div class="setup-title">
                <span>Pre-match Setup</span>
                <div class="setup-title-actions">
                  <button id="reset-status-btn" type="button">Reset status</button>
                  <button id="ready-btn" type="button">Ready</button>
                </div>
              </div>
              <div class="setup-grid">
                <section class="roster">
                  <div class="roster-header">
                    <strong>Roster</strong>
                    <span class="chip" id="roster-count">0/3</span>
                  </div>
                  <div class="roster-list" id="roster-list"></div>
                </section>
                <section class="build">
                  <div class="slot-grid">
                    <button class="slot-card empty show-badge" id="slot-active" type="button">
                      <div class="slot-badge" id="slot-active-badge">★</div>
                      <div class="slot-image">
                        <img id="slot-active-img" alt="" class="hidden" />
                      </div>
                      <div class="slot-name" id="slot-active-name">empty</div>
                    </button>
                    <button class="slot-card empty" id="slot-bench-a" type="button">
                      <div class="slot-image">
                        <img id="slot-bench-a-img" alt="" class="hidden" />
                      </div>
                      <div class="slot-name" id="slot-bench-a-name">empty</div>
                    </button>
                    <button class="slot-card empty" id="slot-bench-b" type="button">
                      <div class="slot-image">
                        <img id="slot-bench-b-img" alt="" class="hidden" />
                      </div>
                      <div class="slot-name" id="slot-bench-b-name">empty</div>
                    </button>
                  </div>
                  <div class="config">
                    <h5>Monster Builder</h5>
                    <div class="config-group moves">
                      <h6>Moves / Lv / Passive</h6>
                      <div class="config-grid" id="moves-grid"></div>
                    </div>
                    <div class="config-group stats">
                      <h6>Stats</h6>
                      <div class="config-grid" id="stats-grid"></div>
                    </div>
                    <div class="warning" id="config-warning"></div>
                  </div>
                </section>
              </div>
              <div class="setup-actions">
                <span class="hint" id="prematch-hint">Select 3 monsters, configure, then Ready.</span>
              </div>
            </div>
          </div>

          <div id="match-end">
            <div class="match-end-card">
              <div class="match-end-title" id="match-end-title">Victory</div>
              <div class="match-end-sub" id="match-end-sub">Match ended.</div>
              <button id="match-end-btn">Back to Setup</button>
            </div>
          </div>
        </div>

        <div class="side-panel" id="side-panel">
          <div class="side-info">
            <div>Room: <span id="status-room">-</span></div>
            <div>Player: <span id="status-name">-</span></div>
            <div>Ping: <span id="status-ping">--</span></div>
          </div>
          <div class="participants">
            <h6>Participants</h6>
            <div class="participants-list" id="participants-list"></div>
          </div>
          <div class="chat">
            <h6>Room Log</h6>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="chat-input">
              <input id="chat-input" type="text" placeholder="Type message..." disabled />
              <button id="chat-send" disabled>Send</button>
            </div>
          </div>
        </div>
      </div>
      <div id="stat-tooltip" class="stat-tooltip" aria-hidden="true"></div>
    </div>
    <script type="module" src="./dist/index.js"></script>
  </body>
</html>
